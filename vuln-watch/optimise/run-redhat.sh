#!/bin/bash

#v5 == https://rhn.redhat.com/errata/rhel-server-errata.html

for OSVER in "" "-6" "-7" ; do

	echo "Getting version $OSVER"

	wget -q -O rhel-server-errata.html https://rhn.redhat.com/errata/rhel-server${OSVER}-errata.html
	ERR=$?
	if [ "$ERR" != "0" ] ; then
		echo "ERROR $ERR at $0"
		exit 1
	fi

	grep errataTableData rhel-server-errata.html > redhat-table.html

	sed -e 's|<script type="text/javascript">var errataTableData = ||; s|\]\].*|\]\]|' redhat-table.html > redhat-array.html

	if [ "$OSVER" = "" ] ; then
		OSVER=-5
	fi

	php RHSA_array_to_CSV.php -r${OSVER}

	echo -n "Number of new errata: "
	wc -l redhat${OSVER}-report.csv

#tidy
	rm -f rhel-server-errata.html redhat-table.html redhat-array.html

done

