#!/bin/sh

#set -x 

URL="https://security-tracker.debian.org/tracker/source-package/exim4"

TMP=.exim-tv.tmp
CHKF=.exim-tv.chk

TITLE="Exim Security page change"
EMAIL="mohclips@gmail.com nicholas.cross@uk.fujitsu.com"


#w3m -dump $URL | grep -A 20 "News & Alerts" > $TMP
w3m -no-graph -dump $URL | awk '/^Resolved issues/,/^---------------/{print $0}' > $TMP

CHK=`cksum $TMP`

if [ -r $CHKF ] ; then
	OLDCHK=`cat $CHKF`
else
	OLDCHK=0
        echo "oops missing chksum"
fi

if [ "$OLDCHK" != "$CHK" ] ; then
	( 
	echo $OLDCHK
	echo $CHK
	echo $URL 
	) | cat - $TMP | s-nail -s "$TITLE" vuln_admin
fi

echo $CHK > $CHKF

