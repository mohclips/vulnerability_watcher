#!/bin/sh

#set -x 

URL="https://www.packtpub.com/free-learning"

TMP=.packt.tmp
CHKF=.packt.chk

TITLE="Packt Free Learning"
EMAIL="mohclips@gmail.com nicholas.cross@uk.fujitsu.com"


w3m -dump $URL | awk '/Free eBook/,/^Register Now/{ print $0 }' | grep -v "^\[" > $TMP

CHK=`cksum $TMP`

if [ -r $CHKF ] ; then
	OLDCHK=`cat $CHKF`
else
	OLDCHK=0
        echo "oops missing chksum"
fi

if [ "$OLDCHK" != "$CHK" ] ; then

	cp $TMP /tmp/packt-$(date -I).tmp

	( 
	echo $OLDCHK
	echo $CHK
	echo $URL 
	) | cat - $TMP | s-nail -s "$TITLE" vuln_admin
fi

echo $CHK > $CHKF

